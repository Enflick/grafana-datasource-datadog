{"version":3,"sources":["../src/add_datadog_func.js"],"names":["getAllFunctionNames","categories","_","reduce","list","category","each","func","push","name","createFunctionDropDownMenu","map","text","submenu","value","click","angular","$","dfunc","module","directive","$compile","inputTemplate","buttonTemplate","link","$scope","elem","getCategories","allFunctions","ctrl","functionMenu","$input","$button","appendTo","attr","typeahead","source","minLength","items","updater","funcDef","getFuncDef","toLowerCase","find","funcName","indexOf","$apply","addFunction","trigger","hide","show","focus","keyup","toggleClass","val","blur","setTimeout","removeClass","contents"],"mappings":"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","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport dfunc from './dfunc';\n\nangular\n  .module('grafana.directives')\n  .directive('datadogAddFunc', function($compile) {\n    var inputTemplate = '<input type=\"text\"'+\n                          ' class=\"gf-form-input\"' +\n                          ' spellcheck=\"false\" style=\"display:none\"></input>';\n\n    var buttonTemplate = '<a  class=\"gf-form-label query-part dropdown-toggle\"' +\n                            ' tabindex=\"1\" gf-dropdown=\"functionMenu\" data-toggle=\"dropdown\">' +\n                            '<i class=\"fa fa-plus\"></i></a>';\n\n    return {\n      link: function($scope, elem) {\n        var categories = dfunc.getCategories();\n        var allFunctions = getAllFunctionNames(categories);\n        var ctrl = $scope.ctrl;\n\n        $scope.functionMenu = createFunctionDropDownMenu(categories);\n\n        var $input = $(inputTemplate);\n        var $button = $(buttonTemplate);\n        $input.appendTo(elem);\n        $button.appendTo(elem);\n\n        $input.attr('data-provide', 'typeahead');\n        $input.typeahead({\n          source: allFunctions,\n          minLength: 1,\n          items: 10,\n          updater: function (value) {\n            var funcDef = dfunc.getFuncDef(value);\n            if (!funcDef) {\n              // try find close match\n              value = value.toLowerCase();\n              funcDef = _.find(allFunctions, function(funcName) {\n                return funcName.toLowerCase().indexOf(value) === 0;\n              });\n\n              if (!funcDef) { return; }\n            }\n\n            $scope.$apply(function() {\n              ctrl.addFunction(funcDef);\n            });\n\n            $input.trigger('blur');\n            return '';\n          }\n        });\n\n        $button.click(function() {\n          $button.hide();\n          $input.show();\n          $input.focus();\n        });\n\n        $input.keyup(function() {\n          elem.toggleClass('open', $input.val() === '');\n        });\n\n        $input.blur(function() {\n          // clicking the function dropdown menu wont\n          // work if you remove class at once\n          setTimeout(function() {\n            $input.val('');\n            $input.hide();\n            $button.show();\n            elem.removeClass('open');\n          }, 200);\n        });\n\n        $compile(elem.contents())($scope);\n      }\n    };\n  });\n\nfunction getAllFunctionNames(categories) {\n  return _.reduce(categories, function(list, category) {\n    _.each(category, function(func) {\n      list.push(func.name);\n    });\n    return list;\n  }, []);\n}\n\nfunction createFunctionDropDownMenu(categories) {\n  return _.map(categories, function(list, category) {\n    return {\n      text: category,\n      submenu: _.map(list, function(value) {\n        return {\n          text: value.name,\n          click: \"ctrl.addFunction('\" + value.name + \"')\",\n        };\n      })\n    };\n  });\n}\n"],"file":"add_datadog_func.js"}