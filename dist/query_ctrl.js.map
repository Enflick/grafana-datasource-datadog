{"version":3,"sources":["../src/query_ctrl.js"],"names":["System","register","_export","_context","_","dfunc","QueryCtrl","queryBuilder","_createClass","DataDogQueryCtrl","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","setters","_lodash","_dfunc","_appPluginsSdk","_func_editor","_add_datadog_func","_query_builder","execute","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","_QueryCtrl","$scope","$injector","uiSegmentSrv","templateSrv","_this","getPrototypeOf","removeText","aggregation","aggregationSegment","newSegment","fake","custom","metric","metricSegment","tags","tagSegments","map","fixTagSegments","functions","func","f","createFuncInstance","funcDef","withDefaultParams","params","slice","as","asSegment","toggleEditorMode","rawQuery","query","buildQuery","getCollapsedText","checkQuery","panelCtrl","refresh","getMetrics","datasource","metricFindQuery","then","transformToSegments","getAggregations","Promise","resolve","text","getAs","getTags","segment","_this2","tagFindQuery","results","type","removeSegment","newFake","unshift","aggregationChanged","metricChanged","asChanged","count","lastSegment","Math","max","push","newPlusButton","targetChanged","error","persistFunctions","def","name","removeFunction","without","addFunction","added","tagSegmentUpdated","index","splice","realSegments","filter","templateUrl"],"mappings":"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","sourcesContent":["'use strict';\n\nSystem.register(['lodash', './dfunc', 'app/plugins/sdk', './func_editor', './add_datadog_func', './query_builder'], function (_export, _context) {\n  \"use strict\";\n\n  var _, dfunc, QueryCtrl, queryBuilder, _createClass, DataDogQueryCtrl;\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (!self) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  }\n\n  return {\n    setters: [function (_lodash) {\n      _ = _lodash.default;\n    }, function (_dfunc) {\n      dfunc = _dfunc.default;\n    }, function (_appPluginsSdk) {\n      QueryCtrl = _appPluginsSdk.QueryCtrl;\n    }, function (_func_editor) {}, function (_add_datadog_func) {}, function (_query_builder) {\n      queryBuilder = _query_builder;\n    }],\n    execute: function () {\n      _createClass = function () {\n        function defineProperties(target, props) {\n          for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n          }\n        }\n\n        return function (Constructor, protoProps, staticProps) {\n          if (protoProps) defineProperties(Constructor.prototype, protoProps);\n          if (staticProps) defineProperties(Constructor, staticProps);\n          return Constructor;\n        };\n      }();\n\n      _export('DataDogQueryCtrl', DataDogQueryCtrl = function (_QueryCtrl) {\n        _inherits(DataDogQueryCtrl, _QueryCtrl);\n\n        function DataDogQueryCtrl($scope, $injector, uiSegmentSrv, templateSrv) {\n          _classCallCheck(this, DataDogQueryCtrl);\n\n          var _this = _possibleConstructorReturn(this, (DataDogQueryCtrl.__proto__ || Object.getPrototypeOf(DataDogQueryCtrl)).call(this, $scope, $injector));\n\n          _this.removeText = '-- remove tag --';\n          _this.uiSegmentSrv = uiSegmentSrv;\n          _this.templateSrv = templateSrv;\n\n          if (_this.target.aggregation) {\n            _this.aggregationSegment = new uiSegmentSrv.newSegment(_this.target.aggregation);\n          } else {\n            _this.aggregationSegment = new uiSegmentSrv.newSegment({\n              value: 'Select Aggregation',\n              fake: true,\n              custom: false\n            });\n          }\n\n          if (_this.target.metric) {\n            _this.metricSegment = new uiSegmentSrv.newSegment(_this.target.metric);\n          } else {\n            _this.metricSegment = new uiSegmentSrv.newSegment({\n              value: 'Select Metric',\n              fake: true,\n              custom: false\n            });\n          }\n\n          _this.target.tags = _this.target.tags || [];\n          _this.tagSegments = _this.target.tags.map(uiSegmentSrv.newSegment);\n          _this.fixTagSegments();\n\n          _this.functions = [];\n          _this.target.functions = _this.target.functions || [];\n          _this.functions = _.map(_this.target.functions, function (func) {\n            var f = dfunc.createFuncInstance(func.funcDef, { withDefaultParams: false });\n            f.params = func.params.slice();\n            return f;\n          });\n\n          if (_this.target.as) {\n            _this.asSegment = uiSegmentSrv.newSegment(_this.target.as);\n          } else {\n            _this.asSegment = uiSegmentSrv.newSegment({\n              value: 'Select As',\n              fake: true,\n              custom: false\n            });\n          }\n\n          return _this;\n        }\n\n        _createClass(DataDogQueryCtrl, [{\n          key: 'toggleEditorMode',\n          value: function toggleEditorMode() {\n            this.target.rawQuery = !this.target.rawQuery;\n            if (this.target.rawQuery)\n              this.target.query = queryBuilder.buildQuery(this.target);\n          }\n        }, {\n          key: 'getCollapsedText',\n          value: function getCollapsedText() {\n            if (this.target.rawQuery) {\n              return this.target.query;\n            } else {\n              return queryBuilder.buildQuery(this.target);\n            }\n          }\n        }, {\n          key: 'checkQuery',\n          value: function checkQuery() {\n            if (!(this.target.query || this.target.query.length != 0)) \n            // to avoid 400 Bad Request, this is the default query\n              this.target.query = 'undefined:undefined{*}';\n            this.panelCtrl.refresh();\n          }\n        }, {\n          key: 'getMetrics',\n          value: function getMetrics() {\n            return this.datasource.metricFindQuery().then(this.uiSegmentSrv.transformToSegments(true));\n          }\n        }, {\n          key: 'getAggregations',\n          value: function getAggregations() {\n            return Promise.resolve([{ text: 'avg by', value: 'avg' }, { text: 'max by', value: 'max' }, { text: 'min by', value: 'min' }, { text: 'sub by', value: 'sum' }]);\n          }\n        }, {\n          key: 'getAs',\n          value: function getAs() {\n            return Promise.resolve([{ text: 'None', value: 'None' }, { text: 'as_count', value: 'as_count' }, { text: 'as_rate', value: 'as_rate' }]);\n          }\n        }, {\n          key: 'getTags',\n          value: function getTags(segment) {\n            var _this2 = this;\n\n            return this.datasource.tagFindQuery().then(this.uiSegmentSrv.transformToSegments(true)).then(function (results) {\n              if (segment.type !== 'plus-button') {\n                var removeSegment = _this2.uiSegmentSrv.newFake(_this2.removeText);\n                results.unshift(removeSegment);\n              }\n\n              return results;\n            });\n          }\n        }, {\n          key: 'aggregationChanged',\n          value: function aggregationChanged() {\n            this.target.aggregation = this.aggregationSegment.value;\n            this.panelCtrl.refresh();\n          }\n        }, {\n          key: 'metricChanged',\n          value: function metricChanged() {\n            this.target.metric = this.metricSegment.value;\n            this.panelCtrl.refresh();\n          }\n        }, {\n          key: 'asChanged',\n          value: function asChanged() {\n            this.target.as = this.asSegment.value;\n            this.panelCtrl.refresh();\n          }\n        }, {\n          key: 'fixTagSegments',\n          value: function fixTagSegments() {\n            var count = this.tagSegments.length;\n            var lastSegment = this.tagSegments[Math.max(count - 1, 0)];\n\n            if (!lastSegment || lastSegment.type !== 'plus-button') {\n              this.tagSegments.push(this.uiSegmentSrv.newPlusButton());\n            }\n          }\n        }, {\n          key: 'targetChanged',\n          value: function targetChanged() {\n            if (this.error) {\n              return;\n            }\n\n            this.panelCtrl.refresh();\n          }\n        }, {\n          key: 'persistFunctions',\n          value: function persistFunctions() {\n            this.target.functions = _.map(this.functions, function (func) {\n              return {\n                funcDef: func.def.name,\n                params: func.params.slice()\n              };\n            });\n          }\n        }, {\n          key: 'removeFunction',\n          value: function removeFunction(func) {\n            this.functions = _.without(this.functions, func);\n            this.persistFunctions();\n            this.targetChanged();\n          }\n        }, {\n          key: 'addFunction',\n          value: function addFunction(funcDef) {\n            var func = dfunc.createFuncInstance(funcDef, { withDefaultParams: true });\n            func.added = true;\n            this.functions.push(func);\n            this.persistFunctions();\n            this.targetChanged();\n          }\n        }, {\n          key: 'tagSegmentUpdated',\n          value: function tagSegmentUpdated(segment, index) {\n            if (segment.value === this.removeText) {\n              this.tagSegments.splice(index, 1);\n            }\n\n            var realSegments = _.filter(this.tagSegments, function (segment) {\n              return segment.value;\n            });\n            this.target.tags = realSegments.map(function (segment) {\n              return segment.value;\n            });\n\n            this.tagSegments = _.map(this.target.tags, this.uiSegmentSrv.newSegment);\n            this.fixTagSegments();\n\n            this.panelCtrl.refresh();\n          }\n        }]);\n\n        return DataDogQueryCtrl;\n      }(QueryCtrl));\n\n      _export('DataDogQueryCtrl', DataDogQueryCtrl);\n\n      DataDogQueryCtrl.templateUrl = 'partials/query.editor.html';\n    }\n  };\n});\n//# sourceMappingURL=query_ctrl.js.map"],"file":"query_ctrl.js"}