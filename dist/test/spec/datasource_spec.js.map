{"version":3,"sources":["../../../spec/datasource_spec.js"],"names":["describe","ctx","beforeEach","$q","Q","backendSrv","datasourceRequest","when","status","templateSrv","replace","str","getAdhocFilters","instanceSettings","url","jsonData","api_key","app_key","ds","Datasource","targets","query","rawQuery","options","range","from","to","it","done","expected_params","method","params","application_key","sinon","spy","expect","have","been","calledWith"],"mappings":";;AAAA;;AACA;;;;AACA;;;;;;AAEAA,SAAS,mBAAT,EAA8B,YAAM;AAClC,MAAIC,MAAM,EAAV;;AAEAC,aAAW,YAAW;AACpBD,QAAIE,EAAJ,GAASC,WAAT;AACAH,QAAII,UAAJ,GAAiB;AACfC,yBAAmB,6BAAM;AACvB,eAAOL,IAAIE,EAAJ,CAAOI,IAAP,CAAY;AACjBC,kBAAQ;AADS,SAAZ,CAAP;AAGD;AALc,KAAjB;AAOAP,QAAIQ,WAAJ,GAAkB;AAChBC,eAAS,iBAACC,GAAD;AAAA,eAASA,GAAT;AAAA,OADO;AAEhBC,uBAAiB;AAAA,eAAM,EAAN;AAAA;AAFD,KAAlB;;AAKA,QAAIC,mBAAmB;AACrBC,WAAK,kCADgB;AAErBC,gBAAU;AACRC,iBAAS,kBADD;AAERC,iBAAS;AAFD;AAFW,KAAvB;AAOAhB,QAAIiB,EAAJ,GAAS,IAAIC,kBAAJ,CAAeN,gBAAf,EAAiCZ,IAAII,UAArC,EAAiDJ,IAAIQ,WAArD,CAAT;AACD,GAtBD;;AAwBAT,WAAS,gCAAT,EAA2C,YAAM;AAC/CE,eAAW,YAAW;AACpB,UAAIkB,UAAU,CACZ,EAAEC,OAAO,sBAAT,EAAiCC,UAAU,IAA3C,EADY,CAAd;;AAIArB,UAAIsB,OAAJ,GAAc;AACZC,eAAO;AACLC,gBAAM,QADD;AAELC,cAAI;AAFC,SADK;AAKZN,iBAASA;AALG,OAAd;AAOD,KAZD;;AAcAO,OAAG,wCAAH,EAA6C,UAACC,IAAD,EAAU;AACrD,UAAIC,kBAAkB;AACpBC,gBAAQ,KADY;AAEpBhB,aAAK,wCAFe;AAGpBiB,gBAAQ;AACNf,mBAAS,kBADH;AAENgB,2BAAiB,kBAFX;AAGNP,gBAAM,KAHA;AAINC,cAAI,KAJE;AAKNL,iBAAO;AALD;AAHY,OAAtB;AAWA,UAAIf,oBAAoB2B,gBAAMC,GAAN,CAAUjC,IAAIiB,EAAJ,CAAOb,UAAjB,EAA6B,mBAA7B,CAAxB;;AAEAJ,UAAIiB,EAAJ,CAAOG,KAAP,CAAapB,IAAIsB,OAAjB;AACAY,aAAO7B,iBAAP,EAA0BoB,EAA1B,CAA6BU,IAA7B,CAAkCC,IAAlC,CAAuCC,UAAvC,CAAkDT,eAAlD;AACAD;AACD,KAjBD;AAkBD,GAjCD;AAkCD,CA7DD","file":"datasource_spec.js","sourcesContent":["import {Datasource} from \"../module\";\nimport Q from \"q\";\nimport sinon from 'sinon';\n\ndescribe('DataDogDatasource', () => {\n  let ctx = {};\n\n  beforeEach(function() {\n    ctx.$q = Q;\n    ctx.backendSrv = {\n      datasourceRequest: () => {\n        return ctx.$q.when({\n          status: 200\n        });\n      }\n    };\n    ctx.templateSrv = {\n      replace: (str) => str,\n      getAdhocFilters: () => []\n    };\n\n    let instanceSettings = {\n      url: 'https://app.datadoghq.com/api/v1',\n      jsonData: {\n        api_key: '0000deadbeaf0000',\n        app_key: '0000abcd0000abcd'\n      }\n    };\n    ctx.ds = new Datasource(instanceSettings, ctx.backendSrv, ctx.templateSrv);\n  });\n\n  describe('When doing DataDog API request', () => {\n    beforeEach(function() {\n      let targets = [\n        { query: 'avg:system.load.5{*}', rawQuery: true }\n      ];\n\n      ctx.options = {\n        range: {\n          from: 12340000,\n          to: 12340000\n        },\n        targets: targets\n      };\n    });\n\n    it('should send request with proper params', (done) => {\n      let expected_params = {\n        method: 'GET',\n        url: 'https://app.datadoghq.com/api/v1/query',\n        params: {\n          api_key: '0000deadbeaf0000',\n          application_key: '0000abcd0000abcd',\n          from: 12340,\n          to: 12340,\n          query: 'avg:system.load.5{*}'\n        }\n      };\n      let datasourceRequest = sinon.spy(ctx.ds.backendSrv, 'datasourceRequest');\n\n      ctx.ds.query(ctx.options);\n      expect(datasourceRequest).to.have.been.calledWith(expected_params);\n      done();\n    });\n  });\n});\n"]}